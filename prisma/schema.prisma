generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mongodb"
  url      = env("DATABASE_URL")
}

enum Role {
  MASTER        // highest access (super admin)
  ADMIN         // admin users
  MANAGER       // manage bookings, staff
  DRIVER        // drivers
  GUIDER        // guider
  USER          // normal customer
}

enum Gender {
  Male
  Female
  Other
}
// Auth model
model Auth {
  id                String   @id @default(auto()) @map("_id") @db.ObjectId
  name              String
  email             String   @unique
  mobile            String   @unique
  username          String   @unique
  password          String
  role              Role     @default(USER)   // ⬅ Add this line
  is_verified       Boolean  @default(false)
  verification_code String   @default("")
  created_at        DateTime @default(now())
  updated_at        DateTime @updatedAt
  profile           Profile?
  driver            Driver?
  guider            Guider?
  booking           Booking[]
}

model TokenBlacklist {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  token     String   @unique
  createdAt DateTime @default(now())
}
model RefreshTokenList {
  id        String   @id @default(auto()) @map("_id") @db.ObjectId
  auth_id   String   @unique @db.ObjectId
  token     String   @unique
  expire_at DateTime @default(now())
}

// -------------------------------------------------------------
// PROFILE MODEL
// -------------------------------------------------------------
model Profile {
  id                String    @id @default(auto()) @map("_id") @db.ObjectId
  auth_id           String    @unique @db.ObjectId
  auth              Auth      @relation(fields: [auth_id], references: [id])
  father_name       String?
  alternate_mobile  String?
  dob               DateTime?
  gender            Gender    @default(Male)
  experience_years  Int? @default(0)
  current_address   String?   @default("")
  permanent_address String?   @default("")
  city              String?
  state             String?
  country           String?
  pincode           String?
  language          String[]  @default([])
  created_at        DateTime  @default(now())
  updated_at        DateTime  @updatedAt
}

// -------------------------------------------------------------
// CAR MODELS
// -------------------------------------------------------------
model Car {
  id            String        @id @default(auto()) @map("_id") @db.ObjectId
  car_name      String
  car_type      String       // Mini, Sedan, SUV
  fuel_type     String?
  seat_capacity Int
  bag_capacity  Int
  base_price    Float
  price_unit    String     
  description   String?
  is_available  Boolean      @default(true)
  features      CarFeatures?
  images        CarImage[]
  drivers       Driver[]   
  bookings      Booking[]
  created_at    DateTime     @default(now())
  updated_at    DateTime     @updatedAt
}

model CarFeatures {
  id                     String  @id @default(auto()) @map("_id") @db.ObjectId
  car_id                 String  @unique @db.ObjectId
  Car                    Car     @relation(fields: [car_id], references: [id])
  ac                     Boolean @default(false)
  gps                    Boolean @default(false)
  music_system           Boolean @default(false)
  automatic_transmission Boolean @default(false)
}

model CarImage {
  id        String @id @default(auto()) @map("_id") @db.ObjectId
  car_id    String @db.ObjectId
  Car       Car    @relation(fields: [car_id], references: [id])
  image_url String
  is_main   Boolean @default(false)
}

// -------------------------------------------------------------
// DRIVER MODEL
// -------------------------------------------------------------

model Driver {
  id                  String   @id @default(auto()) @map("_id") @db.ObjectId
  auth_id             String   @unique @db.ObjectId
  auth                Auth     @relation(fields: [auth_id], references: [id])
  assigned_car_id      String? @db.ObjectId
  car                  Car?     @relation(fields: [assigned_car_id], references: [id])
  bookings             Booking[]

  images              DriverImage[]

  aadhar_number        String?
  pan_number           String?
  driving_license_number String?
  driving_license_expiry  DateTime?

  bank_account_number  String?
  bank_ifsc            String?
  bank_name            String?
  account_holder_name  String?
  upi_id               String


  availability_status  String   @default("offline")
  preferred_city       String?
  preferred_service_area Int? @default(5)

  rating               Float @default(5.0)
  total_rides          Int @default(0)
  cancellation_rate    Float @default(0.0)

  emergency_contact_name    String?
  emergency_contact_number  String?
  emergency_contact_relation String?

  created_at           DateTime @default(now())
  updated_at           DateTime @updatedAt
}

enum ImageType {
   pan           // Driver KYC Documents
   profile
   signature
   aadhar
   driving_license  // Driving Credentials
   health_insurance // Insurance & Health
   term_insurance
   rc_book         // Vehicle Ownership Docs
   puc             // Pollution Certificate (PUC)
   fitness_certificate
   permit
   car_insurance
   pvc              // Optional but useful
   address_proof    // ration card , voter id, electricity bill
}

model DriverImage {
  id           String   @id @default(auto()) @map("_id") @db.ObjectId
  driver_id    String   @db.ObjectId
  driver       Driver   @relation(fields: [driver_id], references: [id])

  image_type   ImageType    
  image_path   String    // "/uploads/driver/xyz.jpg" or "/uploads/docs/abc.png"
  created_at   DateTime  @default(now())
}

model Guider {
  id          String   @id @default(auto()) @map("_id") @db.ObjectId
  auth_id     String   @unique @db.ObjectId
  auth        Auth     @relation(fields: [auth_id], references: [id])
  images      GuiderImage[]
  created_at  DateTime @default(now())
  updated_at  DateTime @updatedAt
}

model GuiderImage {
  id         String   @id @default(auto()) @map("_id") @db.ObjectId
  guider_id  String   @db.ObjectId
  guider     Guider   @relation(fields: [guider_id], references: [id])
  image_type String
  image_path String
  created_at DateTime @default(now())
}

// -------------------------------------------------------------
// POLICY MODEL
// -------------------------------------------------------------
model Policy {
  id                 String   @id @default(auto()) @map("_id") @db.ObjectId
  title              String
  description        String?
  car_type           String?   // Mini/Sedan/SUV
  min_booking_km     Int?      @default(0)
  cancellation_rules String?
  terms_conditions   String?
  created_at         DateTime  @default(now())
  updated_at         DateTime  @updatedAt
}

// -------------------------------------------------------------
// BOOKING MODEL
// -------------------------------------------------------------
model Booking {
  id             String    @id @default(auto()) @map("_id") @db.ObjectId
  user_id        String    @db.ObjectId
  auth           Auth      @relation(fields: [user_id], references: [id])
  car_id         String    @db.ObjectId
  car            Car       @relation(fields: [car_id], references: [id])
  driver_id      String?   @db.ObjectId
  driver         Driver?   @relation(fields: [driver_id], references: [id])
  from_location  String
  to_location    String
  distance_km    Float
  total_price    Float
  booking_time   DateTime  @default(now())
  travel_date    DateTime
  travel_time    String?    // ⬅ added (e.g. "3 hr 25 min")
  trip_type      String     // "one_way" or "round_trip"
  passengers     Json?      // ⬅ ADDED — array of passenger objects
  payment_method String     // Cash, UPI, Card
  payment_status String     // Paid, Pending
  booking_status String     // Confirmed, Cancelled, Completed ,Booked
  transaction    Transaction?
}

// -------------------------------------------------------------
// TRANSACTION MODEL
// -------------------------------------------------------------
model Transaction {
  id               String   @id @default(auto()) @map("_id") @db.ObjectId
  booking_id       String   @unique @db.ObjectId
  Booking          Booking  @relation(fields: [booking_id], references: [id])
  amount           Float
  status           String   // success, failed, pending
  payment_gateway  String?
  created_at       DateTime @default(now())
}